<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RequestValidations.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">interop-transaction-engine</a> &gt; <a href="index.source.html" class="el_package">com.comviva.interop.txnengine.request.validations</a> &gt; <span class="el_source">RequestValidations.java</span></div><h1>RequestValidations.java</h1><pre class="source lang-java linenums">package com.comviva.interop.txnengine.request.validations;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Collections;
import java.util.List;
import java.util.Optional;
import java.util.Set;
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReadWriteLock;
import java.util.concurrent.locks.ReentrantReadWriteLock;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import com.comviva.interop.txnengine.configuration.CurrencyLoader;
import com.comviva.interop.txnengine.configuration.LanguageLoader;
import com.comviva.interop.txnengine.configuration.Resource;
import com.comviva.interop.txnengine.enums.RequestSource;
import com.comviva.interop.txnengine.enums.SourceAccountType;
import com.comviva.interop.txnengine.enums.TransactionTypes;
import com.comviva.interop.txnengine.enums.ValidationErrors;
import com.comviva.interop.txnengine.model.AccountIdentifierBase;
import com.comviva.interop.txnengine.model.RequestValidationResponse;

@Component
public class RequestValidations {

    private LanguageLoader languageLoader;
    private Set&lt;String&gt; languageCodes;

    @Autowired
    private Resource resource;

    @Autowired
    private CurrencyLoader currencyLoader;

<span class="fc" id="L38">    private final ReadWriteLock readWriteLock = new ReentrantReadWriteLock();</span>
<span class="fc" id="L39">    private final Lock readLock = readWriteLock.readLock();</span>
<span class="fc" id="L40">    private final Lock writeLock = readWriteLock.writeLock();</span>

    public void setLanguageCodes(Set&lt;String&gt; languageCodes) {
<span class="fc" id="L43">        writeLock.lock();</span>
        try {
<span class="fc" id="L45">        	this.languageCodes=Collections.unmodifiableSet(languageCodes);</span>
        } finally {
<span class="fc" id="L47">            writeLock.unlock();</span>
        }
<span class="fc" id="L49">    }</span>

    @Autowired
<span class="fc" id="L52">    public RequestValidations(LanguageLoader languageLoader) {</span>
<span class="fc" id="L53">        this.languageLoader = languageLoader;</span>
<span class="fc" id="L54">        this.languageCodes = languageLoader.loadLanguageCodes();</span>
<span class="fc" id="L55">    }</span>

    public ValidationErrors validateSenderMsisdn(String msisdn, int length) {
<span class="fc bfc" id="L58" title="All 2 branches covered.">        if (isEmpty(msisdn)) {</span>
<span class="fc" id="L59">            return ValidationErrors.SENDER_MSISDN_MISSING;</span>
        }
<span class="fc bfc" id="L61" title="All 2 branches covered.">        if (!isNumeric(msisdn)) {</span>
<span class="fc" id="L62">            return ValidationErrors.SENDER_MSISDN_SHOULD_BE_NUMERIC;</span>
        }
<span class="fc bfc" id="L64" title="All 2 branches covered.">        if (!compareLength(msisdn, length)) {</span>
<span class="fc" id="L65">            return ValidationErrors.INVALID_SENDER_MSISDN_LENGTH;</span>
        }
<span class="fc" id="L67">        return ValidationErrors.VALID;</span>
    }

    public ValidationErrors validateReceiverMsisdn(String msisdn, int length) {
<span class="fc bfc" id="L71" title="All 2 branches covered.">        if (isEmpty(msisdn)) {</span>
<span class="fc" id="L72">            return ValidationErrors.RECEVIER_MSISDN_MISSING;</span>
        }
<span class="fc bfc" id="L74" title="All 2 branches covered.">        if (!isNumeric(msisdn)) {</span>
<span class="fc" id="L75">            return ValidationErrors.RECEVIER_MSISDN_SHOULD_BE_NUMERIC;</span>
        }
<span class="fc bfc" id="L77" title="All 2 branches covered.">        if (!compareLength(msisdn, length)) {</span>
<span class="fc" id="L78">            return ValidationErrors.INVALID_RECEVIER_MSISDN_LENGTH;</span>
        }
<span class="fc" id="L80">        return ValidationErrors.VALID;</span>
    }

    public ValidationErrors validatePin(String pin, int length) {
<span class="fc bfc" id="L84" title="All 2 branches covered.">        if (isEmpty(pin)) {</span>
<span class="fc" id="L85">            return ValidationErrors.PIN_MISSING;</span>
        }
       
<span class="fc bfc" id="L88" title="All 2 branches covered.">        if (!compareLength(pin, length)) {</span>
<span class="fc" id="L89">            return ValidationErrors.INVALID_PIN_LENGTH;</span>
        }
<span class="fc" id="L91">        return ValidationErrors.VALID;</span>
    }

    public ValidationErrors validateInteropreferenceid(String interopreferenceid) {
<span class="fc bfc" id="L95" title="All 2 branches covered.">        if (isEmpty(interopreferenceid)) {</span>
<span class="fc" id="L96">            return ValidationErrors.INTEROP_REFERENCE_ID_MISSING;</span>
        }
<span class="fc" id="L98">        return ValidationErrors.VALID;</span>
    }

    public ValidationErrors validateAmount(String amount) {
<span class="fc bfc" id="L102" title="All 4 branches covered.">        if (isEmpty(amount) || !amount.matches(&quot;^[1-9]\\d*(\\.\\d+)?$&quot;)) {</span>
<span class="fc" id="L103">            return ValidationErrors.INCORRECT_AMOUNT_FORMAT;</span>
        }
<span class="fc" id="L105">        return ValidationErrors.VALID;</span>
    }

    public ValidationErrors validateExtOrgRefId(String extOrgRefId) {
<span class="fc bfc" id="L109" title="All 2 branches covered.">        if (isEmpty(extOrgRefId)) {</span>
<span class="fc" id="L110">            return ValidationErrors.EXT_ORG_REF_ID_MISSING;</span>
        }
<span class="fc" id="L112">        return ValidationErrors.VALID;</span>
    }

    public ValidationErrors validateCurrency(String currency) {
<span class="fc bfc" id="L116" title="All 2 branches covered.">        if (isEmpty(currency)) {</span>
<span class="fc" id="L117">            return ValidationErrors.CURRENCY_MISSING;</span>
        }
<span class="fc bfc" id="L119" title="All 2 branches covered.">        if (!Optional.ofNullable(currencyLoader.getCurrencyByCode(currency)).isPresent()) {</span>
<span class="fc" id="L120">            return ValidationErrors.INVALID_CURRENCY;</span>
        }
<span class="fc" id="L122">        return ValidationErrors.VALID;</span>
    }

    public boolean isEmpty(String str) {
<span class="fc bfc" id="L126" title="All 4 branches covered.">        return (null == str || &quot;&quot;.equals(str));</span>
    }

    public boolean isNumeric(String str) {
<span class="fc" id="L130">        String regex = &quot;\\d+&quot;;</span>
<span class="fc" id="L131">        return str.matches(regex);</span>
    }

    public boolean compareLength(String str, int length) {
<span class="fc bfc" id="L135" title="All 2 branches covered.">        return (length == str.length());</span>
    }

    public ValidationErrors validateTransactionType(String type) {
<span class="fc bfc" id="L139" title="All 2 branches covered.">        if (isEmpty(type)) {</span>
<span class="fc" id="L140">            return ValidationErrors.TRANSACTION_TYPE_MISSING;</span>
        }
        
<span class="pc bpc" id="L143" title="1 of 2 branches missed.">        if (!isValidTransactionType(type)) {</span>
<span class="nc" id="L144">            return ValidationErrors.INVALID_TRANSACTION_TYPE;</span>
        }
<span class="fc" id="L146">        return ValidationErrors.VALID;</span>
    }

    public ValidationErrors validateLanguage(String str) {
<span class="fc bfc" id="L150" title="All 2 branches covered.">        if (isEmpty(str)) {</span>
<span class="fc" id="L151">            return ValidationErrors.LANGUAGE_MISSING;</span>
        }

<span class="fc" id="L154">        readLock.lock();</span>
        try {
<span class="fc bfc" id="L156" title="All 2 branches covered.">            if (!languageCodes.contains(str)) {</span>
<span class="fc" id="L157">                return ValidationErrors.LANGUAGE_NOT_SUPPORTED;</span>
            }
        } finally {
<span class="fc" id="L160">            readLock.unlock();</span>
        }
<span class="fc" id="L162">        return ValidationErrors.VALID;</span>
    }

    public RequestValidationResponse createRequestValidationResponse(ValidationErrors code) {
<span class="fc" id="L166">        return new RequestValidationResponse(code.getStatusCode(), code.getEntity().toString());</span>
    }

    public void updateLanguageCodes() {
<span class="fc" id="L170">        this.setLanguageCodes(languageLoader.loadLanguageCodes());</span>

<span class="fc" id="L172">    }</span>

    public ValidationErrors isDateValid(String dateToValidate, String dateFromat) {

<span class="fc" id="L176">        SimpleDateFormat sdf = new SimpleDateFormat(dateFromat);</span>
<span class="fc" id="L177">        sdf.setLenient(false);</span>
        try {
<span class="fc" id="L179">            sdf.parse(dateToValidate);</span>
<span class="fc" id="L180">        } catch (ParseException e) {</span>
<span class="fc" id="L181">            return ValidationErrors.INVALID_DATE_FORMAT;</span>
<span class="fc" id="L182">        }</span>
<span class="fc" id="L183">        return ValidationErrors.VALID;</span>
    }

    public RequestValidationResponse partyValidation(List&lt;AccountIdentifierBase&gt; party, boolean isSenderValidations) {       
<span class="fc bfc" id="L187" title="All 2 branches covered.">        for (AccountIdentifierBase acc : party) {</span>
<span class="pc bpc" id="L188" title="1 of 2 branches missed.">            if (acc.getKey().equals(AccountIdentifierBase.KeyEnum.msisdn)) {</span>
<span class="fc" id="L189">                RequestValidationResponse response = validateMSISDN(isSenderValidations, acc.getValue());</span>
<span class="fc bfc" id="L190" title="All 2 branches covered.">                if (Optional.ofNullable(response).isPresent()) {</span>
<span class="fc" id="L191">                    return response;</span>
                }
            }
<span class="fc" id="L194">        }</span>
<span class="fc" id="L195">        return null;</span>
    }

    private RequestValidationResponse validateMSISDN(boolean isSenderValidations, String value) {
<span class="fc" id="L199">        ValidationErrors code = null;</span>
<span class="fc bfc" id="L200" title="All 2 branches covered.">        if (isSenderValidations) {</span>
<span class="fc" id="L201">            code = validateSenderMsisdn(value, resource.getMsisdnLength());</span>
        } else {
<span class="fc" id="L203">            code = validateReceiverMsisdn(value, resource.getMsisdnLength());</span>
        }
<span class="fc bfc" id="L205" title="All 2 branches covered.">        if (!code.equals(ValidationErrors.VALID)) {</span>
<span class="fc" id="L206">            return createRequestValidationResponse(code);</span>
        }
<span class="fc" id="L208">        return null;</span>
    }

    public RequestValidationResponse validateSenderPIN(String pin) {
<span class="fc" id="L212">        ValidationErrors code = null;</span>
<span class="fc" id="L213">            code = validatePin(pin, resource.getPinLength());</span>
<span class="fc bfc" id="L214" title="All 2 branches covered.">            if (!code.equals(ValidationErrors.VALID)) {</span>
<span class="fc" id="L215">                return createRequestValidationResponse(code);</span>
            }
<span class="fc" id="L217">        return null;</span>
    }
    
    private boolean isValidTransactionType(String txnType) {

<span class="pc bpc" id="L222" title="1 of 2 branches missed.">        for (TransactionTypes types : TransactionTypes.values()) {</span>
<span class="fc bfc" id="L223" title="All 2 branches covered.">            if (types.getTransactionType().equals(txnType)) {</span>
<span class="fc" id="L224">                return true;</span>
            }
        }

<span class="nc" id="L228">        return false;</span>
    }
    
    public ValidationErrors validateProcessingCode(String processingCode) {
<span class="fc bfc" id="L232" title="All 2 branches covered.">        if (isEmpty(processingCode)) {</span>
<span class="fc" id="L233">            return ValidationErrors.PROCESSING_CODE_MISSING;</span>
        }
<span class="fc" id="L235">        return ValidationErrors.VALID;</span>
    }
    
    public ValidationErrors validateIsoAmount(String amount) {
<span class="pc bpc" id="L239" title="1 of 4 branches missed.">        if (isEmpty(amount) || Long.parseLong(amount) == 0) {</span>
<span class="fc" id="L240">            return ValidationErrors.INCORRECT_AMOUNT_FORMAT;</span>
        }
<span class="fc" id="L242">        return ValidationErrors.VALID;</span>
    }
    
    public ValidationErrors validateStan(String stan) {
<span class="fc bfc" id="L246" title="All 2 branches covered.">        if (isEmpty(stan)) {</span>
<span class="fc" id="L247">            return ValidationErrors.SYSTEMAUDITNUMBER_MISSING;</span>
        }
<span class="fc" id="L249">        return ValidationErrors.VALID;</span>
    }
    
    public ValidationErrors validateCountry(String country) {
<span class="fc bfc" id="L253" title="All 2 branches covered.">        if (isEmpty(country)) {</span>
<span class="fc" id="L254">            return ValidationErrors.COUNTRY_CODE_MISSING;</span>
        }
<span class="fc" id="L256">        return ValidationErrors.VALID;</span>
    }
    
    public ValidationErrors validateReferenceNumber(String referenceNumber) {
<span class="fc bfc" id="L260" title="All 2 branches covered.">        if (isEmpty(referenceNumber)) {</span>
<span class="fc" id="L261">            return ValidationErrors.REFERENCE_NUMBER_MISSING;</span>
        }
<span class="fc" id="L263">        return ValidationErrors.VALID;</span>
    }

	public ValidationErrors sourceAccountTypeValidation(String sourceAccountType) {
<span class="pc bpc" id="L267" title="1 of 2 branches missed.">		if (isEmpty(sourceAccountType)) {</span>
<span class="nc" id="L268">            return ValidationErrors.REQUEST_RESOURCE_MISSING;</span>
        }

<span class="pc bpc" id="L271" title="1 of 2 branches missed.">        if (!SourceAccountType.isPaymentAccoutType(sourceAccountType)) {</span>
<span class="nc" id="L272">            return ValidationErrors.INVALID_REQUEST_RESOURCE;</span>
        }
<span class="fc" id="L274">        return ValidationErrors.VALID;</span>
	}

	public ValidationErrors requestSourceValidation(String requestSource) {
<span class="pc bpc" id="L278" title="1 of 2 branches missed.">		if (isEmpty(requestSource)) {</span>
<span class="nc" id="L279">            return ValidationErrors.SOURCE_ACCOUNT_TYPE_MISSING;</span>
        }

<span class="pc bpc" id="L282" title="1 of 2 branches missed.">        if (!RequestSource.isSource(requestSource)) {</span>
<span class="nc" id="L283">            return ValidationErrors.INVALID_SOURCE_ACCOUNT_TYPE;</span>
        }
<span class="fc" id="L285">        return ValidationErrors.VALID;</span>
	}
	
	public ValidationErrors requestNewtorkActionValidation(String networkAction) {
<span class="nc bnc" id="L289" title="All 2 branches missed.">		if (isEmpty(networkAction)) {</span>
<span class="nc" id="L290">            return ValidationErrors.NETWORK_ACTION_MISSING;</span>
        }
<span class="nc" id="L292">        return ValidationErrors.VALID;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>